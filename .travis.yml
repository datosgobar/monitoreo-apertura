sudo: required
dist: trusty

addons:
  apt:
    packages:
    - net-tools
    - openvpn

services:
- docker
- postgresql

language: python
python:
- "2.7"

env:
- DJANGO_SETTINGS_MODULE=conf.settings.testing NODE_JS_VERSION=v8.11.2 DATABASE_USER=postgres DATABASE_PASSWORD='' DATABASE_NAME=travisci DATABASE_HOST=localhost


before_install:
- docker-compose pull
- docker-compose up -d redis
- docker-compose ps

install:
- pip install -r requirements/testing.txt
- nvm install $NODE_JS_VERSION
- nvm use $NODE_JS_VERSION
- npm install

before_script:
- psql -c 'create database travis_ci_test;' -U postgres

script:
- scripts/eslint.sh
- scripts/pep8.sh
- scripts/jscpd.sh
- scripts/pylint.sh
- scripts/tests.sh

deploy:
  - skip_cleanup: true
    provider: script
    script: scripts/deploy/run_deploy.sh testing
    on:
      branch: master
  - skip_cleanup: true
    provider: script
    script: scripts/deploy/run_deploy.sh staging
    on:
      tags: true
